services:
  sonarqube:
    image: sonarqube:26.1.0.118079-community
    container_name: sonarqube
    ports:
      - "9000:9000"
    environment:
      SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: true
      SONAR_JDBC_URL: jdbc:postgresql://postgres16:5432/sonar_db
      SONAR_JDBC_USERNAME: postgres
      SONAR_JDBC_PASSWORD: "postgres"
      #SONAR_WEB_CONTEXT: "/sonarqube"
    volumes:
      - sonarqube_data:/opt/sonarqube/data
      - sonarqube_extensions:/opt/sonarqube/extensions
      - sonarqube_logs:/opt/sonarqube/logs
    networks:
      - web-app-network

  zap:
    image: zaproxy/zap-stable:latest
    container_name: zap
    ports:
      - "8082:8080"
      - "8090:8090"
    environment:
      ZAP_WEBSWING_ENABLED: true
    command: >
      zap.sh -daemon
      -host 0.0.0.0
      -port 8080
      -config api.disablekey=true
      -config api.addrs.addr.name=.*
      -config api.addrs.addr.regex=true
    volumes:
      - zap-data:/zap/wrk/:rw
    restart: unless-stopped
  
networks:
  ### create a custom network, named "web-app-network" to allow communication between containers
  web-app-network: 
    external: true

volumes:
  sonarqube_data:
    name: sonarqube_data
  sonarqube_logs:
    name: sonarqube_logs
  sonarqube_extensions:
    name: sonarqube_extensions
  zap-data:
    name: zap-data